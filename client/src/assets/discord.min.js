var discordWidget=discordWidget||(function(){var b={};var a="1.0";return{init:function(c){c.serverId=typeof c.serverId!=="undefined"?c.serverId:false;c.title=typeof c.title!=="undefined"?c.title:false;c.join=typeof c.join!=="undefined"?c.join:true;c.alphabetical=typeof c.alphabetical!=="undefined"?c.alphabetical:false;c.theme=typeof c.theme!=="undefined"?c.theme:"light";c.hideChannels=typeof c.hideChannels!=="undefined"?c.hideChannels:false;c.showAllUsers=typeof c.showAllUsers!=="undefined"?c.showAllUsers:false;c.allUsersDefaultState=typeof c.allUsersDefaultState!=="undefined"?c.allUsersDefaultState:true;c.showNick=typeof c.showNick!=="undefined"?c.showNick:true;c.userName=typeof c.userName!=="undefined"?c.userName:false;c.useCDN=typeof c.useCDN!=="undefined"?c.useCDN:true;c.apiI=typeof c.apiI!=="undefined"?c.apiI:"https://discordapp.com/api/guilds/";c.apiII=typeof c.apiII!=="undefined"?c.apiII:"/widget.json";c.imgI=typeof c.imgI!=="undefined"?c.imgI:"https://cdn.discordapp.com/icons/";c.imgII=typeof c.imgII!=="undefined"?c.imgII:"/icon.jpg";c.imgIII=typeof c.imgIII!=="undefined"?c.imgIII:"https://cdn.discordapp.com/icons/";c.imgIV=typeof c.imgIV!=="undefined"?c.imgIV:"/icon.png";if(c.serverId===false){return console.log("Error: No serverId provided")}b=c},render:function(){var e=document.createElement("div");e.setAttribute("class","discord-widget");var c=`&nbsp;
<div class="dw-theme dw-${b.theme}">
    <div class="dw-header">
        <div class="dw-guild-icon-container">
            <div class="dw-guild-icon" style="background-image: url('${b.imgI}${b.serverId}${b.imgII}'), url('${b.imgIII}${b.serverId}${b.imgIV}');"></div>
        </div>
        <div class="dw-header-title">
            <span class="dw-header-title-text">${b.title ? b.title : "Loading..."}</span>
            <div id="dw-header-online"></div>
            <div id="dw-header-members"></div>
        </div>
        ${b.join ? '<button class="dw-header-btn">'+this.generateButtonLabel("Join")+'</button>' : ""}
    </div>
    <div class="dw-body">
        <div id="dw-body-error"></div>
        <div class="dw-users"></div>
        <div id="dw-body-expand-btn"></div>
    </div>
</div>`;e.innerHTML=c;for(var d=0;d<document.getElementsByClassName("discord-widget").length;d++){document.getElementsByClassName("discord-widget")[d].innerHTML=e.innerHTML}if(b.join){this.loadJoinBtn()}this.loadServers()},generateButtonLabel:function(c){if(b.theme==="dark"){return`<span style="color: rgb(255, 255, 255);">${c}</span>`}return`<span style="color: rgb(85, 101, 133);">${c}</span>`},loadJoinBtn:function(){for(var c=0;c<document.getElementsByClassName("dw-header-btn").length;c++){document.getElementsByClassName("dw-header-btn")[c].addEventListener("click",function(){window.open("https://discord.gg/"+b.inviteCode,"_blank")})}},loadServers:function(){var c=new XMLHttpRequest();c.onload=function(){if(c.status>=200&&c.status<300){var e=JSON.parse(c.responseText);var d=e.name;var f=e.instant_invite?"https://discordapp.com/invite/"+e.instant_invite.split("/").pop():"https://discordapp.com/channels/"+b.serverId;b.inviteCode=e.instant_invite?e.instant_invite.split("/").pop():false;for(var g=0;g<document.getElementsByClassName("dw-header-title-text").length;g++){document.getElementsByClassName("dw-header-title-text")[g].innerHTML=b.title?b.title:d}if(b.join&&!b.inviteCode){var h=document.getElementsByClassName("dw-header-btn");while(h.length>0){h[0].parentNode.removeChild(h[0])}}if(e.channels.length===0&&e.members.length===0){return discordWidget.showError("Failed to load widget")}return discordWidget.populateMembers(e)}else{return discordWidget.showError("Failed to load widget")}};c.onerror=function(){return discordWidget.showError("Failed to load widget")};if(window.XDomainRequest){c=new XDomainRequest();c.open("GET",b.apiI+b.serverId+b.apiII)}else{c.open("GET",b.apiI+b.serverId+b.apiII,true)}c.send()},showError:function(d){var e=document.getElementsByClassName("dw-users");while(e.length>0){e[0].parentNode.removeChild(e[0])}var c='<div class="dw-body-error">';c+='<span class="dw-body-error-text">'+d+"</span>";c+="</div>";document.getElementById("dw-body-error").innerHTML=c},populateMembers:function(k){var g=document.getElementsByClassName("dw-users");var h=document.getElementById("dw-header-online");var c=document.getElementById("dw-header-members");if(typeof(h)!="undefined"&&h!=null){h.innerHTML=k.presence_count+" "+(k.presence_count==1?"ONLINE":"ONLINE")}if(typeof(c)!="undefined"&&c!=null){c.innerHTML=k.member_count+" "+(k.member_count==1?"MEMBER":"MEMBERS")}var e=[];var l=[];var d="";var j;for(j=0;j<k.channels.length;j++){if(b.hideChannels!==false){if(b.hideChannels.indexOf(k.channels[j].name)!==-1){continue}}e.push('<div class="dw-channel">'+k.channels[j].name+"</div>");var f=[];for(var m=0;m<k.members.length;m++){if(k.members[m].channel_id===k.channels[j].id){f.push(k.members[m])}}f.sort(function(n,i){if(b.alphabetical){if(b.showNick&&n.nick&&i.nick){return n.nick.localeCompare(i.nick)}else{if(b.showNick&&n.nick){return n.nick.localeCompare(i.username)}else{if(b.showNick&&i.nick){return n.username.localeCompare(i.nick)}else{return n.username.localeCompare(i.username)}}}}else{return n.game&&!i.game?-1:!n.game&&i.game?1:0}});for(m=0;m<f.length;m++){if(b.userName!==false&&b.userName!==f[m].username){l.push(f[m]);f.splice(m,1);m--}else{e.push(this.addUser(f[m]))}}if(e[e.length-1]==="undefined"){e.pop()}}k.members.sort(function(n,i){if(b.alphabetical){if(b.showNick&&n.nick&&i.nick){return n.nick.localeCompare(i.nick)}else{if(b.showNick&&n.nick){return n.nick.localeCompare(i.username)}else{if(b.showNick&&i.nick){return n.username.localeCompare(i.nick)}else{return n.username.localeCompare(i.username)}}}}else{return n.game&&!i.game?-1:!n.game&&i.game?1:0}});for(j=0;j<k.members.length;j++){if(l.indexOf(k.members[j])===-1){if(k.members[j].channel_id){continue}if(b.userName!==false&&b.userName!==k.members[j].username){continue}d+=this.addUser(k.members[j])}}var n=document.getElementsByClassName("dw-users");if(e.length>0){for(j=0;j<n.length;j++){n[j].innerHTML='<div class="dw-channels">'+e.join("")+"</div>"}}else{if(d!==""){for(j=0;j<n.length;j++){n[j].innerHTML=d}}else{this.showError("Widget contains no information")}}if(b.showAllUsers&&l.length>0){this.addExpandBtn(l)}},addUser:function(g){var c;if(b.useCDN){c="https://cdn.discordapp.com/avatars/"+g.id+"/"+g.avatar+".jpg"}else{c=g.avatar}if(!g.avatar){c="https://discordapp.com/assets/0e291f67c9274a1abdddeb3fd919cbaa.png"}if(g.status==="dnd"){var e="red";var f='<span class="dw-tooltip dw-tooltip-dnd"></span>'}else{if(g.status==="idle"){var e="yellow";var f='<span class="dw-tooltip dw-tooltip-idle"></span>'}else{var e="green";var f='<span class="dw-tooltip dw-tooltip-online"></span>'}}if(!g.status||g.status==="offline"){var e="lightgray";var f='<span class="dw-tooltip dw-tooltip-offline"></span>'}var d="";if(g.nick&&b.showNick){d=g.nick}else{d=g.username}var h="";var i="";if(g.bot){if(g.bot===true){h='<span class="dw-tooltip">Bot</span>';i="dw-tag-bot"}}if(g.game){h='<span class="dw-tooltip">Playing '+g.game.name+"</span>";if(g.status!=="offline"){i="dw-tag-game"}}return'<div class="dw-user dw-tag '+i+'"><div class="dw-user-avatar"><img class="dw-avatar-img" src="'+c+'"><div class="dw-user-status dw-status-'+e+'"></div>'+f+'</div><div class="dw-user-name">'+d+'</div><div class="dw-user-tag">'+h+"</div></div>"},addExpandBtn:function(c){var g="";var f=c.length;var d=document.getElementById("dw-body-expand-btn");var h=this.generateButtonLabel("Show more users ("+f+")");d.innerHTML='<div class="dw-body-expand"><button class="dw-expand-btn" id="dw-expand-btn">'+h+"</button></div>";document.getElementById("dw-expand-btn").addEventListener("click",function(){var j=this;c.sort(function(l,k){if(b.alphabetical){if(b.showNick&&l.nick&&k.nick){return l.nick.localeCompare(k.nick)}else{if(b.showNick&&l.nick){return l.nick.localeCompare(k.username)}else{if(b.showNick&&k.nick){return l.username.localeCompare(k.nick)}else{return l.username.localeCompare(k.username)}}}}else{return l.game&&!k.game?-1:!l.game&&k.game?1:0}});for(var i=0;i<c.length;i++){g+=discordWidget.addUser(c[i])}e=document.createElement("div");e.setAttribute("class","dw-users-expanded");e.setAttribute("id","dw-users-expanded");e.style.display=b.allUsersDefaultState?"block":"none";e.innerHTML=g;document.getElementsByClassName("dw-body")[0].insertBefore(e,document.getElementById("dw-body-expand-btn"));j.style.display="none"})}}})();